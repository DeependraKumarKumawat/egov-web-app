<!DOCTYPE html>
<html lang="en">

  <head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <meta name="author" content="eGovernments">
    <meta name="keywords" content="Roha, Roha municipality, Roha gov, Roha municipal">
    <meta name="description" content="Roha corporation municipal site...">
    <title>Maharashtra Administration</title>
    <!-- Bootstrap core CSS -->
    <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="css/custom.css" rel="stylesheet">
    <!-- Custom styles for this template -->
    <link rel="shortcut icon" href="images/maha-favicon.ico" type="image/x-icon">
    <link rel="icon" href="images/maha-favicon.ico" type="image/x-icon">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
  </head>
  <body class="gray-bg">

    <script id="service-card-item-template" type="text/x-handlebars-template">
      {{#each .}}
          <div class="card custom-card marg-b10">
            <div class="card-header orange">
              {{@key}}
            </div>
            <div class="card-body">
                <div class="container">
                  <div class="row">
                    {{#each this}}
                      <div class="col-md-4">
                        <a href="javascript:void(0);" data-url="{{redirectUrl}}" data-module-name="{{moduleName}}" data-service-name="{{serviceName}}" class="list-group-item list-group-item-action">
                          {{serviceName}}
                        </a>
                      </div>
                    {{/each}}
                  </div>
              </div>
          </div>
        </div>
      {{/each}}
    </script>

    <!-- Dialog body template -->
    <script id="documents-body-template" type="text/x-handlebars-template">
      <div class="alert alert-danger" role="alert">
         {{#if requiredDocuments}} Required Documents {{else}}  Documents are not required from citizen to avail this service {{/if}}
      </div>

      {{#each requiredDocuments}}
        <div class="card">

          <div class="card-header">
            {{requiredDocumentName}}
          </div>

          <div class="card-body">
            <div class="container">
              <div class="row">
                {{#each documents}}
                  <div class="col-xs-4 col-md-4 col-sm-4 col-lg-4 certificate-name-break">
                    {{inc @index}}) {{name}}
                  </div>
                {{/each}}
              </div>
            </div>
          </div>

        </div>
        <br/>
      {{/each}}
	 </script>

      <nav class="navbar-custom">
        <div class="container">
          <div class="row">
            <div class="col-md-2 col-lg-3 text-left">
              <img src="images/maharashtralogo.png">
            </div>
            <div class="col-md-6 col-lg-6 text-center">
              <h2 class="orange-text">Maharashtra Administarion</h2>
              <h5 class="marg-b5">महाराष्ट्र प्रशासन</h5>
              <h5 class="mrg-b0">Integrated Citizen Services Portal</h5>
            </div>
            <div class="col-md-2 col-lg-3 text-right">
              <img class="image-emblem" src="images/emblem.png">
            </div>
          </div>
        </div>
      </nav>

      <br/>
      <div class="container">
        <div class="row">
          <div class="col-lg-8">
            <h5 style="margin-top: 4px;">SERVICES AVAILABLE ONLINE</h5>
          </div>
          <div class="col-lg-4 text-right">
            <button id="btn-dashboard" type="button" class="btn btn-sm btn-primary img-btn">
              <i class="material-icons">poll</i>
              <span>Dashboard</span>
            </button>
          </div>
        </div>
        <div id="services">

        </div>
    </div>

    <div class="modal fade" id="servicesDetailModal" tabindex="-1" role="dialog" aria-labelledby="servicesDetailModal" aria-hidden="true">
      <div class="modal-dialog lg" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="servicesDetailModalLabel">Modal title</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body small-text" id="documents-body">

          </div>
          <div class="modal-footer">
            <button type="button" id="apply-btn" class="btn btn-primary">Apply</button>
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            <button type="button" onclick="javscript:print();" class="btn btn-secondary">Print</button>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.10/handlebars.min.js"></script>
    <script src="vendor/popper/popper.min.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.min.js"></script>
    <script>

     function arrayGroupByKey(arry, groupByKey){
				var resultData={};
				var result=arry.reduce(function(result, current) {
				    result[current[groupByKey]] = result[current[groupByKey]] || [];
				    result[current[groupByKey]].push(current);
				    return result;
				}, {});

				Object.keys(result).sort().forEach(function(key) {
				  resultData[key] = result[key];
				});
				return resultData;
		 }

     var servicesListByModule={};
     var servicesList=[];

     $(document).ready(function(e){

         var servicesCardTemplate = Handlebars.compile($('#service-card-item-template').html());
         var documentsTempalte = Handlebars.compile($('#documents-body-template').html());

         $('#btn-dashboard').click(function(e){
           window.open('http://mahadma.egovernments.org/dashboard/');
         });

         $.ajax({
            url: 'data/servicesList.json',
             type:'GET',
            data:{ "_": $.now() },
            headers: {
             'Cache-Control': 'max-age=1000'
            },
            success: function(response){
               console.log('repsonse', response);
               servicesListByModule = arrayGroupByKey(response, "moduleName");
               servicesList=response;
               console.log('servicesList', servicesListByModule);
               $('#services').html(servicesCardTemplate(servicesListByModule));
            }
         });

         $(document).on('click', 'a.list-group-item-action', function(e){
           var serviceRedirectUrl=$(this).attr('data-url');
           if(serviceRedirectUrl){
             $('#servicesDetailModal').modal('hide');
             window.open(serviceRedirectUrl);
           }
         });

        //  $(document).on('click', 'a.list-group-item-action', function(e){
         //
        //    //console.log('serviceName', $(this).data('service-name'));
        //    var serviceName = $(this).data('service-name');
        //    $('#servicesDetailModalLabel').html($(this).data('service-name'));
         //
        //    var service=servicesList.find((service)=>service.serviceName === serviceName);
        //    if(service){
        //      //documentsTempalte
        //      $('#apply-btn').attr('data-url', service.redirectUrl);
        //      $('#documents-body').html(documentsTempalte(service));
        //      $('#servicesDetailModal').modal('show');
        //    }
        //    else{
        //      //else TODO
        //    }
        //  });

         $('#apply-btn').click(function(e){
             var serviceRedirectUrl=$(this).attr('data-url');
             if(serviceRedirectUrl){
               $('#servicesDetailModal').modal('hide');
               window.open(serviceRedirectUrl);
             }
         });

      });


    </script>
  </body>

</html>
